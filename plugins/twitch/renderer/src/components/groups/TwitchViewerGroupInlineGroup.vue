<template>
	<div class="inline-group p-1">
		<div class="inline-group-header flex flex-row mb-5">
			<p-button text size="small" @click="model.userIds.push('')"><i class="mdi mdi-plus" />{{ tSync("plugins.twitch.common.viewer") }}</p-button>
			<div class="flex-grow-1"></div>
			<p-button
				text
				size="small"
				:icon="excluded ? 'mdi mdi-equal' : 'mdi mdi-not-equal-variant'"
				@click="excluded = !excluded"
			></p-button>
			<p-button text size="small" icon="mdi mdi-delete" @click="emit('delete')"></p-button>
		</div>
		<data-binding-path local-path="userIds">
			<div class="flex flex-row mt-4" v-for="(viewer, i) in model.userIds">
				<data-input
					:schema="viewerSchema"
					v-model="model.userIds[i]"
					:local-path="`[${i}]`"
					class="flex-grow-1 flex-grow-0 w-0"
				/>
				<p-button text size="small" icon="mdi mdi-delete" @click="model.userIds.splice(i, 1)"></p-button>
			</div>
		</data-binding-path>
	</div>
</template>

<script setup lang="ts">
import { TwitchViewer, TwitchViewerGroupInlineList } from "castmate-plugin-twitch-shared"

import { useModel } from "vue"
import { DataInput, DataBindingPath, tSync } from "castmate-ui-core"
import PButton from "primevue/button"
import { declareSchema } from "castmate-schema"

const props = defineProps<{
	modelValue: TwitchViewerGroupInlineList
	excluded: boolean
}>()

const model = useModel(props, "modelValue")
const excluded = useModel(props, "excluded")
const emit = defineEmits(["delete"])

const viewerSchema = declareSchema({
	type: TwitchViewer,
	required: true,
	name: tSync('plugins.twitch.common.viewer'),
})
</script>

<style scoped>
.inline-group {
	border-radius: var(--border-radius);
	border: solid 1px var(--surface-d);
}

.excluded > * > .inline-group {
	border-color: red;
	border-top-left-radius: 0;
	border-bottom-left-radius: 0;
}
</style>
